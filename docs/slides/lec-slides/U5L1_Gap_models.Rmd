---
title: "Gap models/Individual-based models"
author: "Aitor Ameztegui"
institute: "University of Lleida"
date: "2018-01-22"
output:
  xaringan::moon_reader:
    css: [default, "slides.css"]
    logo: 
    lib_dir: libs
    mathjax: "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML"

    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: true
editor_options: 
  chunk_output_type: console
---

```{r packages, echo=FALSE, message=FALSE, warning=FALSE}
```

```{r setup, include=FALSE}
# R options
options(
  htmltools.dir.version = FALSE, # for blogdown
  show.signif.stars = FALSE,     # for regression output
  warm = 1
  )
# Set dpi and height for images
library(knitr)
opts_chunk$set(fig.height = 2.65, dpi = 300) 
# ggplot2 color palette with gray
color_palette <- list(gray = "#999999", 
                      salmon = "#E69F00", 
                      lightblue = "#56B4E9", 
                      green = "#009E73", 
                      yellow = "#F0E442", 
                      darkblue = "#0072B2", 
                      red = "#D55E00", 
                      purple = "#CC79A7")


```


# Background/context

.left-column[![](img/U5/barra_arbol.png)]

.right-column[
* Long-time interest of ecologists for long-term dynamics of forest ecosystems (Clements 1916, Gleason 1926, Whittaker 1953)

* Only in the 60s-70s there was enough computing capability to construct complex mathematical models

* The first attempts (1964-1969) were fully three-dimensional, individual-based tree models (3-D geometry of each individual crown, crown interactions, stem volume at various heights…)

* 1972: JABOWA, first gap model (Botkin et al. 1972) 
Stand structure and composition are the summary of births, deaths and growth of hundreds of individual tres  individual-based models, but are more simple and mimic gap dynamics theory  gap models
]

---

# Gap dynamics theory

.left-column[![](img/U5/barra_arbol.png)]

.right-column[
* Gaps: small openings in a forest canopy(usually less than 1 ha)

* In temperate forests, gaps form at 0.5-2.0% per year, due to natural mortality, windthrows, pests…

* Gap size varies, favouring species with different shade-tolerance

* Gaps provide micro-environmental conditions that allow the establishment of shade intolerant species. Allows to maintain their populations in mature or old-growth forests.

* Valid in several biomes: all?
]
---
class:full-screen
background-image:url("img/U5/gap_BC.png")

---

# JABOWA model (1972)

.pull-left[
* Janak, Botkin and Wallis
* Collaboration between Hubbard Brook Experimental forest and IBM 
* Based on gap dynamics theory, makes a series of assumptions
* Is the basis of ALL gap models]

.pull-right[
![](img/U5/hubbard_sign.png)
![](img/U5/hubbard_watershed.png)
]

![](img/U5/hubbard_forest.png)


---

# JABOWA model (1972)

### Four basic assumptions

.pull-left-wide[
.font90[1. The forest stand is abstracted as a composite of many patches, each with different age and successional stage. Patch size so that one large individual can dominate the patch. For trees: 100-1000 m2

2. Patches are horizontally homogeneous, i.e. tree position within a patch is not considered. All tree crowns extend horizontally across the entire patch. 

3. The leaves of each tree are located in an indefinitely thin layer (disk) at the top of the tree

4. Successional processes are described on each patch separately, i.e. there are no interactions between patches
]

.center[
Assumes horizontal competition among individuals within a patch is homogeneous, but is spatially explicit in the vertical dimension
 Simplification, but allowed for mixed-age, mixed-species stands
]
]
.pull-left-wide-right[
![](img/U5/jabowa_poster.png)

![](img/U5/jabowa_layers.png)
]

---
# JABOWA model (1972)

### Additional assumptions 

.pull-left-wide[
.font90[
5. The entity modeled is the individual: establishment, growth and mortality of each individual is considered

6. Considers composition and structure, but not functioning (biogeochemical cycles, flows of water, photosynthesis…)

7. Other life-forms (shrubs, grasses) are ignored

8. Establishment comes from an external list of potential colonists

![](img/U5/jabowa_web.png)
]
]

.pull-left-wide-right[
![](img/U5/jabowa_book.png)

https://www.danielbbotkin.com/jabowa/

30 days trial ($150 for license)


]

---

# JABOWA model:quick summary

.center[![](img/U5/jabowa_summary.png)]
---

# JABOWA model: growth

Growth is modeled as a deterministic process, based on maximum posible growth, which is reduced by a series of scalars.

$$\frac{\Delta D}{\Delta t} = G·D·(1-\frac{D·H}{D_{max}·H_{max}})·\frac{1}{b(D)}·f(e)$$
.pull-left[
where:
* $D$ is diameter
* $H$ is tree height (allometric function of D) 
* $G$ is max. Relative Growth rate 
* $b(D)$ is a function encapsulating the allometric relationship
* $D_{max}$ and Hmax are maximum tree size
]

.pull-right[
![](img/U5/jabowa_growth.png)
]

---

# JABOWA model: growth reductors (I)

Optimal growth is reduced based on three scalars [0-1]

$$f(e) = g_1(AL)·g_2(SBAR)·g_3(DD)$$
.pull-left-wide[
$g_1(AL)$ is a function of available light 

$g_2(SBAR)$ is a function of stand basal area 

$g_3(DD)$ is a function of temperature (annual degree-day sum)
]
.pull-left-wide-right[
![](img/U5/growth.png)
]
.pull-left-wide[

* The only resource for which there is explicit competition is light

* Belowground resources are summarized in the SBAR factor

* Drought not explicitly modeled (not important in New Hampshire)

]

---

# JABOWA model: growth reductors (II)


.tri-col-left[
#### Light availability factor
Height is determined using allometric function of D (parabollic)
]

.tri-col-center[
![](img/U5/allom_HD.png)
]

.tri-col-right[]


---
# JABOWA model: growth reductors (II)

.tri-col-left[
#### Light availability factor
Height is determined using allometric function of D (parabollic)

LAI is calculated via a simple allometric relationship to diameter 
$$	LAI = cD^2/k$$


]

.tri-col-center[
![](img/U5/allom_HD.png)
]

.tri-col-right[
![](img/U5/allom_LD.png)
]

---

# JABOWA model: growth reductors (II)

.tri-col-left[
#### Light availability factor

Height is determined using allometric function of D (parabollic)

LAI is calculated via a simple allometric relationship to diameter 
$$	LAI = cD^2/k$$

Light extinction is predicted using the Beer-Lambert law. LA at the top of each tree is used to derive the AL scalar. 
]

.tri-col-center[
![](img/U5/allom_HD.png)
![](img/U5/allom_beer.png)
]

.tri-col-right[
![](img/U5/allom_LD.png)
]
---

# JABOWA model: growth reductors (II)

.tri-col-left[
#### Light availability factor
Height is determined using allometric function of D (parabollic)

LAI is calculated via a simple allometric relationship to diameter 
$$	LAI = cD^2/k$$

Light extinction is predicted using the Beer-Lambert law. LA at the top of each tree is used to derive the AL scalar. 
]

.tri-col-center[
![](img/U5/allom_HD.png)
![](img/U5/allom_beer.png)
]

.tri-col-right[
![](img/U5/allom_LD.png)
![](img/U5/allom_growth_light.png)

]
---

# JABOWA model: growth reductors (II)

.tri-col-left[
#### Light availability factor
Height is determined using allometric function of D (parabollic)

LAI is calculated via a simple allometric relationship to diameter 
$$	LAI = cD^2/k$$

Light extinction is predicted using the Beer-Lambert law. LA at the top of each tree is used to derive the AL scalar. 
]

.tri-col-center[
![](img/U5/allom_HD.png)
![](img/U5/allom_beer.png)
]

.tri-col-right[
![](img/U5/allom_LD.png)
![](img/U5/allom_growth_light.png)

]

.pull-left[
.font90[
* No asymptotic height allometry
* LAI should not increase indefinitely but reach a plateau
* All leaves are at the top of the tree (no overlap)
]
]
.pull-right[
So… JABOWA overestimates the amount of shade cast by large trees, increasing their competitive strength
]

---

# JABOWA model: growth reductors (III)


### Basal area factor

.pull-left-wide[
* Basal area integrates other resources for which trees compete (water, nutrients)

* Growth decreases linearly with basal area (not species-specific)

]

.pull-left-wide-right[![](img/U5/jabowa_BAF.png)]

### Temperature factor
.pull-left-wide[
* Sum of degree days serves as an index of available energy for plant growth

* Uses a parabollic relationship


]

.pull-left-wide-right[![](img/U5/growth_parab.png)]



---

# JABOWA model: growth reductors (III)


### Basal area factor

.pull-left-wide[
* Basal area integrates other resources for which trees compete (water, nutrients)

* Growth decreases linearly with basal area (not species-specific)

]

.pull-left-wide-right[![](img/U5/jabowa_BAF.png)]

### Temperature factor
.pull-left-wide[
* Sum of degree days serves as an index of available energy for plant growth

* Uses a parabollic relationship

* This equation has been widely used in gap models but is heavily criticized

]

.pull-left-wide-right[![](img/U5/growth_asymp.png)]

---

# JABOWA model: establishment

.pull-left-wide[
* No interactions between patches, so assumes all tree species are present in each patch (100 m2)
* New trees are added based on three criteria (3-D regeneration niche):
    
.font80[
    * Light availabily at the floor must be > species-specific threshold
* Annual sum of eavapotranspiration must be > species-specific threshold
* Annual sum of degree days (DD) must lie within a range tolerated by the species
]
]
.pull-left-wide-right[
![](img/U5/recruitment.png)]


.pull-left[
* Number of trees is random within ranges:
    * 0-200 for shade tolerants
    * 0-1300 for mid-tolerants
    * 6000-7500 for shade intolerants

* Tree size at establishment is 0.5 cm (not seedling stage)
]

.pull-right[![](img/U5/niche.png)]


---

# JABOWA model: mortality

.pull-left-wide[
* Stochastic process with two components
    * Background mortality: (2% of trees reach maximum tree size)   
    * Stress-related mortality: acts when growth < 0.01 cm/year (not species-specific)]
.pull-left-wide-right[![](img/U5/mortality.png)]

![](img/U5/mortality_bugmann.png)

---

# JABOWA model: conclusions

.pull-left[.font90[
* Very simple model, still useful

* ALL gap models are direct descendants of JABOWA
* Almost all the assumptions have been challenged, scrutinized or replaced --> large variety of gap models
]]
--
.pull-right[![](img/U5/gap_models_tree.png)]

![](img/U5/gap_models_use.png)
---

# Gap models: FORET (1977)

.pull-left[
* Still assumes that the forest can be divided into small (typically the size of a large canopy tree) cells. 

* The most recent versions include the effects of local competition among cells.

* New seedlings are produced by the adult trees on the landscape (prop. to abundance)

* However, these seedlings are often dispersed globally (non-spatial)
]

.pull-right[
![](img/U5/foret_poster.png)
![](img/U5/gap_models_tree.png)
]
---

# Variations in assumptions in gap models

.pull-left[.font90[
1) **Forest as a mosaic of patches:** all gap models but SORTIE-ND

2) **Horizontal structure within a patch:** almost all gap models retain this assumption. Patch size usually not so important, but causes problems when photosynthesis and respiration are added (model 4C; solved using estimates of crown projection area)

3) **All leaves are at the top of the tree:** several alternatives have been tried

* FORSKA: adds two state variables (crown height and leaf area from pipe model) --> crown overlap, leads to family of based models. FORSKA >> ZELIG in Picea-Pinus

* SORTIE: further sophistication, includes individual tree crowns and transmissivity
]
]

.pull-right[
![](img/U5/gap_models_tree.png)
.pull-left[![](img/U5/forska_canopy.png)]
.pull-right[
</br>
</br>
![](img/U5/SORTIE_canopy.png)]
]
---

class:font100
# Variations in assumptions in gap models

.pull-left[
4) **Relationships between patches:**
* ZELIG (Urban, 1990); newer versions of FORET 
* PICUS and SORTIE add seed dispersal
* SORTIE-ND (2005): spatially-explicit, individual-based competition
]

.pull-right[
![](img/U5/gap_poster.png)]

.pull-left-wide[
5) **Entities being modelled:**
* Modelling all trees is time-consuming, and since growth is deterministic…
* ForClim (Bugmann, 1996) introduces the use of cohorts. All trees established a year are identical (simulation time ¼)
* Further simplifications: 
    * Few size classes (FLAM, FORMIX)
    * use of functional types instead of species
    * Statistical simplification: Markov chains (probability between states; MOSAIC) or partial differential equations (DisCForM)


6) **Ecosystem structure and function**

Recently, gap modelers try to go beyond structure and function (photoshynthesis, carbon balance): physiology-based gap models 4C, HYBRID and FIRE-BGC were the first, but then many models
]

.pull-left-wide-right[
![](img/U5/forclim.png)
]



---
# Variations in processes

.pull-extleft[.small[
1) **GROWTH**
* Different allometric relationships
* Less simplistic allocation
* Competition for light similar to JABOWA
* Competition for other resources generally not included except in physiology-based models 
* Change parabolic temperature effect for asymptotic

2) **ESTABLISHMENT:** tended to high diversity in each patch and low across patches
* First improvement: seed availability depends on presence of mature trees
* Second improvement: horizontal relationships between patches are considered
* Most still use filters to define n-dimensional regeneration space

3) **MORTALITY**
* Most models use stochastic “background” mortality
* Stress-related mortality is used in all models, but the definition of “stress” varies
* Clear trend to include disturbance-related mortality: pests, fires, windthrow, **HARVEST!!!!**
]
]

.pull-extleft-right[
![](img/U5/growth.png)
![](img/U5/recruitment.png)
![](img/U5/mortality.png)
]

---
# The dynamics of gap models: variations in assumptions through time

### From simplicity to complexity… and back

![](img/U5/gap_complexity.png)

---
# The dynamics of gap models: variations in assumptions through time

### From simplicity to complexity… and back

![](img/U5/gap_complexity2.png)
---
# Implications and limitations of gap models

Gap models simulate long-term population dynamics - which are slow – on small patches and with several stochastic processes.

1) The stochasticity makes a single simulation of little interest. Standard: several runs and statistical treatments (average, median, sd, kurtosis…)  less practical

2) Few data sources to initialize stands due to the smaller scale of most measurements. Standard practice to initialize from “bare ground” and wait for dynamics to stabilize (~400-800 years). Gap models mostly used to simulate secondary succession less practical

3) This raises the limitation on climatic data availability for such long series. 

4) Difficult to validate, due to limitations in the comparability. No forest will have gone through exactly the same processes (management!!). Model evaluation more used than proper validation  importance of long-term data!

5) Original models not valid to assess effects of climate change. Newer versions are much better, include some physiology but number of parameters!!!

---

# Examples of Gap Models

.pull-left[
## FORCLIM (1986)
* Inclusion of cohorts (groups of trees with same age and diameter)– smaller patches

* Establishment, growth, competition and mortality in each patch

* Assumes no interaction between patches, forest succession in a patch is independent on neighbor patches

* PLANT, WEATHER, WATER, MANAGEMENT (Mechanistic hydrology)
]

.pull-right[
![](img/U5/forclim_process.png)

]

---

# Examples of Gap Models


.pull-left[
## SORTIE-ND (1995,2005)

* All trees are simulated

* Position of each tree is defined, competition by individual neighbors

* Allows simulation of complex, mixed-species stands

* Allows complex management systems

* Several dozens of behaviors (growth, mortality, dispersal, browsing) and equations
]

.pull-right[
![](img/U5/sortie_poster.png)
![](img/U5/sortie_trees.png)
]
---

# To know more

Bugmann, H., 2001. A review of forest gap models. Climatic Change 51, 259–305.

Fontes, L., Bontemps, J.-D., Bugmann, H., Van Oijen, M., Gracia, C., Kramer, K., Lindner, M., Rötzer, T., Skovsgaard, J.P., 2011. Models for supporting forest management in a changing environment. Forest Systems 3, 8. 

Larocque, G.R., Shugart, H.H., Xi, W., Holm, J.A., 2016. Forest Succession Models 43.

Liu, J., Ashton, P.S., 1995. Individual-based simulation models for forest succession and management. Forest Ecology and Management 73, 157–175

Porté, A., Bartelink, H.H., 2002. Modelling mixed forest growth: a review of models for forest management. Ecological Modelling 150, 141–188. 

Shugart, H.H., Wang, B., Fischer, R., Ma, J., Fang, J., Yan, X., Huth, A., Armstrong, A.H., 2018. Gap models and their individual-based relatives in the assessment of the consequences of global change. Environmental Research Letters 13, 033001. 




# The dynamics of gap models: variations in assumptions








